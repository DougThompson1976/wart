(test "read works"
  :valueof (making stdin (instring "34 35")
             (read))
  :should be '(34 35))

system "echo abc > _x"
(test "read works on fd"
  :valueof (making stdin (infd:input_fd "_x")
             (read))
  :should be 'abc)
system "rm _x"

(test "multiple reads work"
  :valueof (making stdin (instring "34
35")
             (read)
             (read))
  :should be 35)

(test "read_byte works"
  :valueof (w_instring "ab"
             (read_byte)
             (read_byte))
  :should be 98)

(test "w_infile works"
  :valueof (let f (tmpfile)
             (before (system:join "rm " f)
               (w_outfile f
                 (prn 34))
               (w_infile f
                 (read))))
  :should be 34)

(test "w_ versions clean up after themselves"
  :valueof (let f (tmpfile)
             (before (system:join "rm " f)
               (w_outfile f
                 (prn 34))
               (numBindings 'stdin)))
  :should be 1)
