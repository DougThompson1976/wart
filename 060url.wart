(def urldecode(s)
  (tostring
    (forlen i s
      (caselet c s.i
        #\+ (write-char #\space)
        #\% (do (when (< i (- len.s 2))
                  (write-char (as character
                                  (int (cut s 1+.i (+ i 3)) :base 16))))
                (++ i 2))
            (write-char c)))))

(def urlencode(s)
  (tostring
    (each c s
      (write-char #\%)
      (let i int.c
        (if (< i 16) (write-char #\0))
        (pr (str i :base 16))))))
