def inline((ff . args) env)
  iflet f env.ff
    (cons 'do
          ; XXX: multiple-eval
          (replace f!body :bindings (as table (zip f!sig args))))

def replace(expr bindings)
  if !cons?.expr
    (or bindings.expr expr)
    (cons (replace car.expr bindings)
          (replace cdr.expr bindings))

def inline((ff . args) env) :case (iso ff 'do)
  (cons 'do
         (collect:each form args
           yield (inline form env)))
