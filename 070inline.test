prn.
(test "to-with-expr works"
 :valueof (to-with-expr '(foo 1 2 (list 3 4) @(list 5 6) 7)
                        (table 'foo (let x 34
                                      (fn(a b (c d) e . f)
                                        (list a b c d e f)))))
 :should be '(with (x 34)
               (with ((a b (c d) e . f) (list 1 2 (list 3 4) @(list 5 6) 7))
                 (list a b c d e f))))

(test "to-with-expr passes through unknown calls"
 :valueof (to-with-expr '(foo 1 2) (table))
 :should be '(foo 1 2))

(test "to-with-expr handles nested calls"
 :valueof (to-with-expr '(foo 1 2)
                        (table 'foo (fn(a b)
                                      (bar a b))
                               'bar (fn(c d)
                                      (baz c d))))
 :should be '(with ()
               (with ((a b) (list 1 2))
                 (with ()
                   (with ((c d) (list a b))
                     (baz c d))))))
