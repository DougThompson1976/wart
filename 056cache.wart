(def cache(timef valf)
  (with (cached nil gentime nil)
    (thunk
      (unless (and cached (< since.gentime (call timef)))
        (= cached (call valf)
           gentime (seconds)))
      cached)))

(mac defcache(name lasts . body)
  `(do1 nil
     (= (symbol-function ',name)
        (cache (thunk ,lasts)
               (thunk ,@body)))))
