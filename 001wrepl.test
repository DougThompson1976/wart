; testing 001wrepl.lisp requires more than just 001wrepl.lisp

(test-wc "wc works through defuns"
  :valueof (wc '(defun foo(n) (let it n (+ it 1))))
  :should be '(defun foo(n) (wc-let it n (+ it 1))))

(test-wc "lookup-quoted-handler handles function-names"
  :valueof (lookup-quoted-handler 'let)
  :should be 'wc-let)

(test "wc-1 handles quoted special names"
  :valueof (wc-1 '(quote let))
  :should be '(quote wc-let))

(test "wc handles quoted special names"
  :valueof (wc '(backq-list* 'let))
  :should be '(backq-list* 'wc-let))

(test-wc "wc works through backquote"
  :valueof (_let n 3 `(let it ,n (+ it 1)))
  :should be '(wc-let it 3 (+ it 1)))

(test "wc works through defmacro"
  :valueof (wc '(defmacro foo(n) `(let it ,n (+ it 1))))
  :should be '(defmacro foo(n) `(wc-let it ,n (+ it 1))))

(wc-eval '(mac aand(a b) `(let it ,a (and it ,b))))
(test-wc "macro bodies should pass through the compiler"
  :valueof (let x 3 (aand (- x 1) (> it 1)))
  :should be t)
