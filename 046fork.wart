(require :sb-posix)

; clone a process that stops after executing child
(def fork(child)
  (let pid (sb-posix:fork)
    (if (zerop pid)
      (after
        (call child)
      :do
        (quit)))))

(synonym wait-for-children sb-posix:wait
         getpid sb-posix:getpid)



(mac spawn args
  `(perform
     (sb-thread:make-thread (thunk ,@args))))
