mac matching(vars vals . body)
  `(if (match ',vars ,vals)
     let ,strip_underscores.vars ,vals
      ,@body)

mac if args :case (and (match '(let . _) car.args) cadr.args)
  `(if (match ',cadr:car.args ,@cddr:car.args)
     (matching ,@cdr:car.args
       ,cadr.args)
     ,@cddr.args)



;; Internals

def strip_underscores(vars)
  (if
    cons?.vars
      (cons strip_underscores:car.vars strip_underscores:cdr.vars)
    (iso str.vars.0 "_")
      (sym (str.vars 1 nil))
    :else
      vars)
