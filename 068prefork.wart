;; http://common-lisp.net/pipermail/small-cl-src/2004-June/000064.html

(def start-server()
  (w/socket s 1978
    (repeat 2
      (fork (thunk
              (handle-request s))))
    (sb-posix:wait)))

(def handle-request(s)
  (accepting stream :from s
    (format stream "Hello ~A, this is PID ~D~%"
            (read-line stream) (sb-posix:getpid))
    (flush stream)))
