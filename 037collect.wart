(defvar *yield* [])
(def yield(_) (call *yield* _))

(mac collect body
  `(withs (,$acc (queue)
           *yield* [enq ,$acc _])
     ,@body
     (as cons ,$acc)))
